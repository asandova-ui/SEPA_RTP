<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prototipo RTP con Roles</title>
  <!-- Bootstrap CSS -->
  <link 
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
  >
  
  <!-- Estilos propios -->
  <style>
    /* Ejemplo de estilos personalizados */
    body {
      background-color: #f8f9fa;
    }
    .card-header {
      font-weight: bold;
    }
    .section-title {
      margin-top: 1rem;
      margin-bottom: 1rem;
      color: #444;
      text-decoration: underline;
    }
    .invisible-section {
      display: none; /* para ocultar secciones */
    }
    .fadeIn {
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    .small-note {
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>
<body>

<div class="container my-4">
  <h1 class="text-center mb-4">Prototipo SEPA RTP con Actores y Roles</h1>

  <!-- ROW SUPERIOR -->
  <div class="row">
    <!-- COLUMNA 1: Crear Actores -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">1. Crear Actores</div>
        <div class="card-body">
          <p>Crea actores de cada tipo: Beneficiary, PSP Beneficiary, PSP Payer y Payer.</p>
          
          <div class="d-grid gap-2">
            <!-- Botón 1: Crear Beneficiary -->
            <button class="btn btn-success" onclick="crearActor('beneficiary')">
              Crear Beneficiary
            </button>
            <!-- Botón 2: Crear PSP Beneficiary -->
            <button class="btn btn-warning text-dark" onclick="crearActor('psp_beneficiary')">
              Crear PSP Beneficiary
            </button>
            <!-- Botón 3: Crear PSP Payer -->
            <button class="btn btn-info text-white" onclick="crearActor('psp_payer')">
              Crear PSP Payer
            </button>
            <!-- Botón 4: Crear Payer -->
            <button class="btn btn-danger" onclick="crearActor('payer')">
              Crear Payer
            </button>
          </div>

          <!-- Mensaje de resultado tras crear Actor -->
          <div id="actorCreationResponse" class="alert alert-secondary mt-3 invisible-section"></div>
        </div>
      </div>
    </div>

    <!-- COLUMNA 2: Seleccionar Actor actual -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-secondary text-white">2. Seleccionar Actor Activo</div>
        <div class="card-body">
          <p>Una vez creados los actores, indica aquí el ID de uno para “actuar” como él.</p>
          <form id="selectActorForm" class="row g-3">
            <div class="col-auto">
              <label for="actorIdSelect" class="visually-hidden">ID del Actor</label>
              <input type="number" class="form-control" id="actorIdSelect" placeholder="actor_id">
            </div>
            <div class="col-auto">
              <button type="submit" class="btn btn-primary">Usar este actor</button>
            </div>
          </form>
          <!-- Resumen del actor actual -->
          <div class="mt-3 invisible-section" id="currentActorCard">
            <h6>Actor Actual:</h6>
            <p><strong>ID:</strong> <span id="currentActorId"></span></p>
            <p><strong>Rol:</strong> <span id="currentActorRole"></span></p>
          </div>
          <div id="selectActorError" class="alert alert-danger mt-2 invisible-section"></div>
        </div>
      </div>
    </div>
  </div> <!-- fin row superior -->


  <!-- SEPARADOR 3: Acciones específicas según rol -->
  <hr>
  <h3 class="section-title">3. Acciones según el Rol del Actor Actual</h3>

  <!-- Beneficiary Actions -->
  <div class="card mb-4 invisible-section fadeIn" id="beneficiaryActions">
    <div class="card-header bg-success text-white">Acciones: Beneficiary</div>
    <div class="card-body">
      <p>Crea un RTP indicando los IDs de su PSP, del PSP del pagador y del Payer final.</p>
      <form id="createRTPForm" class="row g-3 mb-3">
        <div class="col-md-4">
          <label for="ibanField" class="form-label">IBAN</label>
          <input type="text" id="ibanField" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="amountField" class="form-label">Monto</label>
          <input type="number" step="0.01" id="amountField" class="form-control" required>
        </div>

        <div class="col-md-4">
          <label for="pspBenefField" class="form-label">PSP Benef. ID</label>
          <input type="number" id="pspBenefField" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="pspPayerField" class="form-label">PSP Payer ID</label>
          <input type="number" id="pspPayerField" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="payerField" class="form-label">Payer ID</label>
          <input type="number" id="payerField" class="form-control" required>
        </div>

        <div class="col-md-12 d-flex justify-content-end">
          <button type="submit" class="btn btn-success">Crear RTP</button>
        </div>
      </form>
      <div id="createRTPResponse" class="alert alert-secondary invisible-section"></div>
    </div>
  </div>

  <!-- PSP Beneficiary actions -->
  <div class="card mb-4 invisible-section fadeIn" id="pspBeneficiaryActions">
    <div class="card-header bg-warning text-dark">Acciones: PSP Beneficiary</div>
    <div class="card-body">
      <p class="small-note">Valida y enruta un RTP ya creado.</p>
      <!-- Validar RTP (Beneficiary) -->
      <form id="validateBeneficiaryForm" class="row g-3 mb-3">
        <div class="col-md-3">
          <label for="rtpIdValidateBene" class="form-label">ID del RTP</label>
          <input type="number" id="rtpIdValidateBene" class="form-control" required>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-warning text-white">Validar Beneficiary</button>
        </div>
      </form>
      <div id="validateBeneficiaryResponse" class="alert alert-secondary invisible-section"></div>

      <!-- Enrutar RTP -->
      <form id="routeForm" class="row g-3">
        <div class="col-md-3">
          <label for="rtpIdRoute" class="form-label">ID del RTP</label>
          <input type="number" id="rtpIdRoute" class="form-control" required>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-warning text-white">Enrutar RTP</button>
        </div>
      </form>
      <div id="routeResponse" class="alert alert-secondary invisible-section"></div>
    </div>
  </div>

  <!-- PSP Payer actions -->
  <div class="card mb-4 invisible-section fadeIn" id="pspPayerActions">
    <div class="card-header bg-info text-white">Acciones: PSP Payer</div>
    <div class="card-body">
      <p class="small-note">Validar un RTP que ya esté “enrutado”.</p>
      <form id="validatePayerForm" class="row g-3">
        <div class="col-md-3">
          <label for="rtpIdValidatePayer" class="form-label">ID del RTP</label>
          <input type="number" id="rtpIdValidatePayer" class="form-control" required>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-info text-white">Validar Payer</button>
        </div>
      </form>
      <div id="validatePayerResponse" class="alert alert-secondary invisible-section"></div>
    </div>
  </div>

  <!-- Payer actions -->
  <div class="card mb-4 invisible-section fadeIn" id="payerActions">
    <div class="card-header bg-danger text-white">Acciones: Payer</div>
    <div class="card-body">
      <p class="small-note">Decidir (aceptar o rechazar) el RTP.</p>
      <form id="decisionForm" class="row g-3">
        <div class="col-md-3">
          <label for="rtpIdDecision" class="form-label">ID del RTP</label>
          <input type="number" id="rtpIdDecision" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label for="decision" class="form-label">Decisión</label>
          <select id="decision" class="form-select">
            <option value="aceptado">aceptado</option>
            <option value="rechazado">rechazado</option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-danger">Enviar Decisión</button>
        </div>
      </form>
      <div id="decisionResponse" class="alert alert-secondary invisible-section"></div>
    </div>
  </div>

  <!-- VER LOGS -->
  <h3 class="section-title">4. Logs de Cambios de Estado</h3>
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">Historial de Logs</div>
    <div class="card-body">
      <p>Para ver todos los eventos registrados.</p>
      <button id="showLogs" class="btn btn-dark">Mostrar Logs</button>
      <div id="logsResponse" class="mt-3"></div>
    </div>
  </div>

</div> <!-- container -->

<!-- Scripts de Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Nuestro app.js -->
<script src="app.js"></script>

</body>
</html>
